//https://book-elements.github.io - disengage safety protocols Engelman-Alpha_121
!(async function({Array: _, console: t, customElements: e, CustomEvent: s, document: o, fetch: i, HTMLElement: a, localStorage: n, location: r, Object: d, navigator: l, setTimeout: u, URLSearchParams: h, Promise: c} = window) {
    function x(..._) {
        t.log(`%c ${_.shift()}`, "background:gold", ..._);
    }
    function g(..._) {
        t.error(`%c ${_.shift()}`, "background:red;color:white", ..._);
    }
    const p = "background:red;color:white", E = _ => e.get(_), m = (_, t = "", e = "") => `<${_} ${e}>${t}</${_}>`, b = "_chapter", f = "loading", A = (_ = "div", {prepend: t = [], append: e = [], style: s = {}, attrs: i = {}, ...a} = {}, n = o.createElement(_)) => {
        t.length && n.prepend(...t), e.length && n.append(...e), d.keys(s).length && d.assign(n.style, s);
        for (const [_, t] of d.entries(i)) n.setAttribute(_, t);
        return d.assign(n, a);
    }, y = (_, t = {}) => A("style", {
        textContent: _,
        ...t
    }), k = (_ = r.search) => new h(_), w = (_, t = "") => k().get(_) || n.getItem(_) || t, v = _ => k().has(_), $ = o.currentScript.src.split("?")[1], C = k($), S = C.get("prefix") || "book", N = C.get("chapterprefix") || "chapter";
    x("Component Prefix except: <book-reader> = ", S);
    const L = "civilaization", I = "book", R = "lang", T = "nr", H = "translation", M = "chapter", B = "en", O = w("english", "gb"), P = "h2", D = "book-loaded", q = "add-chapter", j = "language-changed", z = "another-chapter", F = "paragraph-at-top", J = "reindex-chapternumbers", U = "paragraph", K = "chapter", G = "action", Q = "detail", W = "chapter-highlight", V = "chapter-number", Y = "translated";
    o.head.append(A("script", {
        src: "https://toast-message.github.io/element.js",
        onload: () => x("<toast-message> loaded with <script> and defined")
    }));
    const Z = _ => {
        o.querySelector("toast-message") ? showToastMessage(_) : u((() => {
            Z(_);
        }), 100);
    }, X = "connectedDoneCallback", __ = "renderedCallback", t_ = "renderedOnceCallback", e_ = "@keyframes fadeIn{from{opacity:0}to{opacity:1}}{name}{animation:fadeIn 1s forwards}", s_ = "chapterlabel", o_ = "chaptertitle", i_ = "language-select", a_ = {
        AREA51: {
            name: "book-reader",
            css: ":host{font:18px arial;margin:0 auto;padding:0;max-width:1024px}:host{--radius:0px;--titlebackground:steelblue;--textcolor:beige;--aicolor:gold;--chaptertitle:#9C2E35;--chapteractions:indianred;--scrollblock:var(--chaptertitle);--scrollbar:#eee;var(--titlebackground);--chapter-title-size:1.2em;}@keyframes fadeOut{from{opacity:1}to{opacity:0}}.fade-out{animation:fadeOut 1s forwards}" + e_ + ':host{height:95vh;overflow:hidden}:host{display:grid;gap:var(--radius);grid-template-rows:auto 1fr;grid-template-columns:2em 1fr;grid-template-areas:"header header" "left right"}',
            shadowRoot: "open"
        },
        Exodus_20_15___AA: {
            name: S + "-title",
            css: "{name}{user-select:none;grid-area:header}{name} h1{padding:0.25em;background:var(--titlebackground);color:var(--textcolor);margin-block:0;border-radius:var(--radius)}{name} h1{text-shadow:1px 1px 1px black}" + e_ + "{name} span{font-style:italic;color:var(--aicolor)}"
        },
        Exodus_20_15___Y: {
            name: S + "-chapter-numbers",
            css: `{name}{user-select:none;grid-area:left;display:flex;flex-direction:column}.${V} {display:flex;flex:1;align-items:center;justify-content:center}.${V} {opacity:.5;margin-bottom:0;border-radius:var(--radius);background:lightblue;cursor:pointer}.${W} {opacity:1;background:var(--chaptertitle);color:var(--textcolor)}` + e_
        },
        Exodus_20_15___Z: {
            name: S + "-chapter-number",
            css: ""
        },
        Exodus_20_15___AC: {
            name: N + "-title",
            css: `{name}{display:block;position:sticky;top:0em;padding:.3em .5em;user-select:none;margin-block:0;background:var(--chaptertitle);color:var(--textcolor);border-top-left-radius:var(--radius);text-shadow:1px 1px 1px black}[part='${s_}']{display:block;font-size:0.6em}[part='${o_}']{font-size:var(--chapter-title-size);margin-block:0em}`
        },
        Exodus_20_15___AD: {
            name: N + "-actions",
            css: "{name}{background:var(--chapteractions);display:flow-root;border-bottom-left-radius:var(--radius)}{name}{position:sticky;xtop:2.5em}"
        },
        Exodus_20_15___AH: {
            name: S + "-chapters",
            css: "{name}{display:flex;flex-direction:column;grid-area:right}{name}{border-radius:var(--radius)}{name}{overflow-y:scroll;scroll-margin:3em;{name}{scroll-behavior:smooth;scrollbar-width:auto;scrollbar-color:var(--scrollblock) var(--scrollbar)}"
        },
        Exodus_20_15___AI: {
            name: S + "-chapter",
            css: "{name}{background:beige}" + e_ + "{name} img{display:block;max-width:80vh;margin:0 auto}"
        },
        Exodus_20_15___AB: {
            name: N + "-paragraphs",
            css: "{name}{display:block;margin:0 0.5em}{name} p{text-wrap:balance;hyphens:auto;hyphenate-limit-chars:10}"
        },
        Exodus_20_15___AE: {
            name: "svg-flag",
            css: ""
        },
        Exodus_20_15___AJ: {
            name: "flag-baseclass",
            shadowRoot: "open",
            css: "img{width:var(--flagsize,40px);margin:5px;cursor:pointer}"
        },
        Exodus_20_15___AK: {
            name: "translate-languages",
            css: `{name}{float:right;margin-right:2em}.${Y} {opacity:.2;order:0}`
        },
        Exodus_20_15___AL: {
            name: "language-choices",
            css: `:host{position:relative;float:right;right:4px}:host{--flagsize:1em}:host([${H}]){opacity:.2}`
        },
        Exodus_20_15___AM: {
            name: "language-flag",
            css: ""
        },
        Exodus_20_15___AN: {
            name: "translate-flag",
            css: "{name}{display:inline-block;vertical-align:top;height:100%}{name}{opacity:.2}{name}:hover{opacity:1}"
        },
        Exodus_20_15___AF: {
            name: "svg-icon",
            css: "{name}{float:right;margin:5px}{name} svg:hover{cursor:pointer;stroke:beige;fill:beige}"
        },
        Exodus_20_15___AG: {
            name: "chapter-github-link",
            css: ""
        }
    };
    x(`Web Components:(${S} -elements)`, d.keys(a_).map((_ => "<" + a_[_].name + ">")).join(", "));
    const n_ = _ => a_[_].css.replaceAll("{name}", a_[_].name).replaceAll("}", "}\n");
    class r_ extends a {
        log(..._) {
            performance.now(), this.urlParams || (this.urlParams = new h(window.location.search));
            let e = _.shift();
            if ("object" == typeof e && null != e.color || (_.unshift(e), e = {
                log: 9,
                linenr: 1,
                filename: 0,
                color: "grey,beige"
            }), e.filename = this.urlParams.get("logfile") ? 1 == this.urlParams.get("logfile") : e.filename || 0, 
            e.log = this.urlParams.get("log") ? +this.urlParams.get("log") : e.log || 0, !this.log.run) {
                let _ = (..._) => t.log("%c log ", "background:pink;color:black", ..._);
                this.log.run = performance.now(), u((() => {
                    _("log.run end", (performance.now() - this.log.run).toFixed(1)), delete this.log.run;
                }), 2e3), _("log.run", e), this.log.linenr = 0;
            }
            let s = t => {
                if ("number" == typeof t && t < 9) return t >= e.log || (_.shift(), !1);
            };
            if ("string" == typeof _[0] && _[0].length > 1) {
                let [t, o, i, ...a] = _[0].split("");
                if (";" == o || ";" == i) {
                    if (";" == o && a.unshift(i), s(t)) return;
                    e.method = {
                        e: "error",
                        w: "warn",
                        i: "info",
                        d: "dir",
                        g: "group",
                        ">": "groupCollapsed",
                        "<": "groupEnd"
                    }[t] || "log", _[0] = a.join("");
                }
            } else if (s(_[0])) return;
            let o = [], i = [], a = (_, t) => {
                o.push(`%c${_}`), i.push(t);
            }, n = (new Error).stack.split("\n").filter(Boolean);
            n[0].includes("Error") && n.shift(), n = n.slice(0, 5).map((_ => {
                (_ = _.split(_.includes("@http") ? "@" : " (")).length < 2 && _.unshift("root");
                let t = _[1].split("/").slice(-1)[0].split(":");
                return t.length < 2 && t.unshift("anonFunc"), [ _[0].includes(".") ? _[0].split(".")[1] : _[0], t[0].replace(".js", ""), t[1].padStart(4, " ") + " " ];
            }));
            let r = n.findIndex((([_]) => void 0 !== _ && "log" !== _ && "warn" !== _ && "error" !== _)), [d, l, c] = n[r];
            l = l.split("?")[0], (l.includes("anonymous") || l.includes(".html")) && (l = "HTMLFunction");
            let [x, g] = e.color.split(",");
            if (e.linenr && a(c, "font-size:80%"), e.filename && a(` ${l} `, `background:${x};color:${g}`), 
            l !== this.localName && a(` <${this.localName}> `, "background:gold;color:black"), 
            "string" == typeof _[0] && _[0].includes("%c")) {
                let t = _.shift().replace("%c", ""), e = _.shift();
                e.includes("background:") || ([x, g] = e.split(";"), e = `background:${x};color:${g}`), 
                a(t, e);
            }
            this.log.autoCollapsed = e.collapse || !0, this.log.linenr == c ? this.log.Collapsed ? t[e.method || "log"](o.join(""), ...i, ..._) : (i.unshift(i.shift() + ";background:lightgreen"), 
            t.groupCollapsed(o.join(""), ...i, ..._), this.log.Collapsed = !0) : (this.log.Collapsed && (t.groupEnd(), 
            this.log.Collapsed = !1), t[e.method || "log"](o.join(""), ...i, ..._)), this.log.linenr = c;
        }
        Exodus_20_15___c({type: _, func: t = (() => "voodoo"), scope: e = o, options: s = {}}) {
            e.addEventListener(_, t, s);
            let i = () => e.removeEventListener(_, t, s);
            return this.Exodus_20_15___b = this.Exodus_20_15___b || [], this.Exodus_20_15___b.push(i), 
            i;
        }
        Exodus_20_15___d({type: _ = "CustomEvent", detail: t = {}, bubbles: e = !0, composed: o = !0, scope: i = this}) {
            w("emit", !1) && this.log(0, `%c Exodus_20_15___d:${_} `, "background:lightcoral", t), 
            i.dispatchEvent(new s(_, {
                detail: t,
                bubbles: e,
                composed: o
            }));
        }
        Exodus_20_15___e(_, t = this) {
            return t && t != o && t != window ? t.closest(_) : t && t != o && t != window ? this.Exodus_20_15___e(_, t?.getRootNode()?.host || t?.parentNode) : null;
        }
        Exodus_20_15___Q() {
            return this.Exodus_20_15___y.tagName.toLowerCase() + "-event";
        }
        Exodus_20_15___AS() {
            d.getOwnPropertyNames(d.getPrototypeOf(this)).forEach((_ => {
                _.startsWith("_EVENT_") && this.Exodus_20_15___S({
                    [G]: _,
                    func: t => this[_](t)
                });
            }));
        }
        Exodus_20_15___S({[G]: _, func: t}) {
            this.log(2, `%c Exodus_20_15___c:${_} `, "background:lightgreen"), this.Exodus_20_15___c({
                type: this.Exodus_20_15___Q(),
                func: e => {
                    let {action: s, ...o} = e[Q];
                    s == _ && t(e);
                }
            });
        }
        Exodus_20_15___R(_, e = {}) {
            _.includes("DISC") && this.log("%c event-emit ", "background:lightblue", _, {
                detail: e
            }), t.assert(_, `No action in Exodus_20_15___R, use[${G}]`), this.Exodus_20_15___d({
                type: this.Exodus_20_15___Q(),
                [Q]: {
                    action: _,
                    ...e
                }
            });
        }
        get Exodus_20_15___y() {
            let _ = this.Exodus_20_15___e(a_.AREA51.name);
            if (_) return _;
            if (_ = o.querySelector(a_.AREA51.name), _) return _;
            throw new Error("No book-reader found");
        }
        get Exodus_20_15___ysrc() {
            if (this.hasAttribute(I)) return !1;
            let _ = this.Exodus_20_15___y.getAttribute("src");
            return _.includes("/book") && (_ = _.split("/book")[0]), _;
        }
        get Exodus_20_15___z() {
            return this.Exodus_20_15___y.getAttribute(I);
        }
        get Exodus_20_15___t() {
            return this.Exodus_20_15___y.shadowRoot;
        }
        get Exodus_20_15___h() {
            return this.Exodus_20_15___t.querySelector(a_.Exodus_20_15___AH.name);
        }
        get Exodus_20_15___w() {
            return [ ...this.Exodus_20_15___h.querySelectorAll(a_.Exodus_20_15___AI.name) ];
        }
        get Exodus_20_15___is() {
            return this.Exodus_20_15___e(a_.Exodus_20_15___AH.name);
        }
        get Exodus_20_15___i() {
            return this.Exodus_20_15___e(a_.Exodus_20_15___AI.name);
        }
        get Exodus_20_15___g() {
            return this.Exodus_20_15___i?.[T];
        }
        get Exodus_20_15___C() {
            return this.Exodus_20_15___z + "_chapterNr";
        }
        get Exodus_20_15___B() {
            const _ = this.Exodus_20_15___C;
            let t = Number(w(M, n.getItem(_) || 1));
            return isNaN(t) && (t = 1), t;
        }
        set Exodus_20_15___B(_) {
            if (this.Exodus_20_15___B !== _) {
                const t = this.Exodus_20_15___C;
                Z(`saved to localStorage:${t}=${_}`), n.setItem(t, _);
            }
        }
        Exodus_20_15___F(_ = "en", t = 1) {
            return `/chapters/chapter-${String(t).padStart(3, "0")}-${_}.md`;
        }
        Exodus_20_15___j(_) {
            return this.Exodus_20_15___t.querySelector(a_.Exodus_20_15___AI.name + `[${T}="${_}"]`);
        }
        Exodus_20_15___k(_) {
            return [ ...this.Exodus_20_15___t.querySelectorAll(`[id^="p-${_}-"]`) ];
        }
        Exodus_20_15___r(_) {
            return this.Exodus_20_15___k(_)[0];
        }
        Exodus_20_15___s(_) {
            return this.Exodus_20_15___k(_).slice(-1)[0];
        }
        Exodus_20_15___a({element: _ = this, block: e = "start", behavior: s = "smooth", inline: o = "nearest"}) {
            _ ? _.scrollIntoView({
                behavior: s,
                block: e,
                inline: o
            }) : t.warn("no scroll on element:", _);
        }
        #_;
        Exodus_20_15___l(_, t = this.Exodus_20_15___j(_)) {
            this.log(0, "gotoChapter", t), this.Exodus_20_15___a({
                element: t
            }), this.Exodus_20_15___R(F, {
                chapter: t
            });
        }
        get Exodus_20_15___m() {
            return w(R, B);
        }
        set Exodus_20_15___m(_) {
            const t = new h(r.search), e = w("reload", !1);
            t.set(R, _), n.setItem(R, _), history.pushState({}, "", "?" + t.toString()), e ? r.search = t.toString() : this.Exodus_20_15___R(j, {
                lang: _
            });
        }
        get Exodus_20_15___v() {
            return r.href.substring(0, r.href.lastIndexOf("/"));
        }
        get Exodus_20_15___x() {
            return "/book/" + (this.Exodus_20_15___y.getAttribute(I) || L);
        }
        get Exodus_20_15___u() {
            let _;
            if (this.Exodus_20_15___y.hasAttribute(I)) _ = "." + this.Exodus_20_15___x; else {
                const t = this.Exodus_20_15___y.getAttribute("src"), e = this.Exodus_20_15___v + this.Exodus_20_15___x;
                _ = t || e;
            }
            return _;
        }
        set Exodus_20_15___u(_) {
            this.log(0, "set Exodus_20_15___u", _), this.setAttribute("src", _);
        }
        Exodus_20_15___n(_, t = {}, e = _.name, s = e) {
            return t = {
                part: s.replace(S + "-", ""),
                ...t
            }, A(e, t);
        }
        async Exodus_20_15___o({src: _ = !1, lang: e = this.Exodus_20_15___m, nr: s = 1}) {
            _ || (("us" == e || "gb" == e) && (e = B), _ = this.Exodus_20_15___u + this.Exodus_20_15___F(e, s) + "?fetchChapter");
            try {
                const o = await i(_);
                if (!o.ok) return g(o.status, _, e, s), o.status;
                const a = await o.text();
                return a.length < 800 && a.includes("Warning") && t.warn(a), a;
            } catch (_) {
                return void t.warn(_.message, e, s, this.Exodus_20_15___D);
            }
        }
        Exodus_20_15___p({nr: _ = 1, lang: t = B, action: e = "defaultJSON"}) {
            let s;
            return s = this.Exodus_20_15___ysrc ? this.Exodus_20_15___ysrc + `/api.php?action=${e}&${T}=${_}&${R}=${t}` : this.Exodus_20_15___v + this.Exodus_20_15___x + "/allchapters.json", 
            this.log("%c APIcall ", "background:lightcoral;color:black", s), s;
        }
        get Exodus_20_15___E() {
            let _ = this.Exodus_20_15___y.Exodus_20_15___D, t = _?.languages;
            if (t) return t;
            g("No languages in JSON ", _ || this.Exodus_20_15___y);
        }
        get Exodus_20_15___q() {
            if (this.Exodus_20_15___E) {
                let e = new Set(d.keys(this.Exodus_20_15___E)), s = w(H, "");
                return s = new Set([ ...s ].filter((_ => 2 == _.length))), [ ...(_ = e, t = s, new Set([ ..._, ...t ])) ];
            }
            var _, t;
            g("No $ISO languages");
        }
        connectedCallback() {
            this.Exodus_20_15___AS(), this[X] && this[X](), this[__] && u((() => this[__]())), 
            this[t_] && u((() => {
                this[t_](), delete this[t_];
            }));
        }
    }
    e.define(a_.AREA51.name, class extends r_ {
        static get observedAttributes() {
            return [ "src", "book" ];
        }
        attributeChangedCallback(_, t, e) {
            this.isConnected && this.log(2, "attributeChanged:", _, t, e);
        }
        constructor() {
            super().attachShadow({
                mode: a_.AREA51.shadowRoot
            }).append(A("grouped-styles", {
                append: [ y(n_("AREA51") + n_("Exodus_20_15___AA"), {
                    id: "book_elements"
                }), y(n_("Exodus_20_15___Y"), {
                    id: "chapter_numbers"
                }), y(n_("Exodus_20_15___AH") + n_("Exodus_20_15___AI") + n_("Exodus_20_15___AC") + n_("Exodus_20_15___AD") + n_("Exodus_20_15___AB"), {
                    id: "chapter_elements"
                }), y(n_("Exodus_20_15___AK") + n_("Exodus_20_15___AF") + n_("Exodus_20_15___AN"), {
                    id: "flags_and_icons"
                }), this.titles = y(`${a_.Exodus_20_15___AH.name} [part="${s_}"], ${a_.Exodus_20_15___AH.name} ${a_.Exodus_20_15___AB.name}{display:none}`, {
                    id: "toggle_titles",
                    onload: () => {
                        this.titles.disabled = !v("titles");
                    }
                }) ]
            }));
        }
        [X]() {
            this.Exodus_20_15___A();
        }
        Exodus_20_15___AP(t) {
            const e = Math.max(...d.values(t).map((_ => _.length)));
            d.entries(t).forEach((([t, s]) => {
                const o = _.from({
                    length: e
                }, ((_, t) => t + 1)).filter((_ => !s.includes(_)));
                o.length && g(`Missing chapters ${t}:`, o.join(", "));
            }));
        }
        async Exodus_20_15___A() {
            let _, e = !1;
            const s = this.Exodus_20_15___p({});
            try {
                _ = await i(s);
            } catch (_) {
                e = !0, _.message.includes("Failed to fetch") && g(_.message, s);
            }
            if (!e) try {
                this.Exodus_20_15___D = await (_.ok ? _.json() : {}), t.assert(this.Exodus_20_15___D.hasOwnProperty("languages"), `%c ${s} does not have 'languages' key `, p), 
                this.Exodus_20_15___AP(this.Exodus_20_15___D.languages);
            } catch (_) {
                g("invalid JSON format", _.message, s), e = !0;
            }
            this.Exodus_20_15___O = w("count", this.Exodus_20_15___D.chaptercount), this.log("%c renderBook:", "background:lightgreen", {
                [S]: this.Exodus_20_15___u,
                API: {
                    src: s,
                    JSON: this.Exodus_20_15___D
                },
                languages: d.keys(this.Exodus_20_15___E || {}),
                dbacces: {
                    dbaccount: "ratteval",
                    dbpassword: "R0deHar1ng",
                    dblogin: "https://roads-technology.nl/components/passwords/instructions.mp4"
                }
            }), this.shadowRoot.append(this.Exodus_20_15___n(a_.Exodus_20_15___AA), this.Exodus_20_15___n(a_.Exodus_20_15___Y), this.Exodus_20_15___n(a_.Exodus_20_15___AH));
            const a = {
                F5: _ => {
                    r.reload();
                },
                PageUp: _ => {
                    this.Exodus_20_15___B > 1 && this.Exodus_20_15___l(this.Exodus_20_15___B - 1);
                },
                PageDown: _ => {
                    this.Exodus_20_15___B < this.Exodus_20_15___O && this.Exodus_20_15___l(this.Exodus_20_15___B + 1);
                },
                ArrowUp: _ => {
                    this.Exodus_20_15___h.scrollBy(0, -200);
                },
                ArrowDown: _ => {
                    this.Exodus_20_15___h.scrollBy(0, 200);
                },
                Home: _ => {
                    this.Exodus_20_15___a({
                        element: this.Exodus_20_15___r(this.Exodus_20_15___B),
                        block: "center"
                    });
                },
                End: _ => {
                    this.Exodus_20_15___a({
                        element: this.Exodus_20_15___s(this.Exodus_20_15___B),
                        block: "center"
                    });
                },
                t: _ => {
                    this.Exodus_20_15___AR();
                },
                c: _ => {
                    this.Exodus_20_15___h.Exodus_20_15___H({
                        idx: 1
                    });
                }
            };
            u((() => {
                this.log(0, "UI keys", d.keys(a).join(", "));
            }), 500), o.addEventListener("keydown", (_ => {
                _.preventDefault(), a[_.key] ? a[_.key](_) : t.warn("Key", _.key);
            }));
        }
        async [__]() {
            this.Exodus_20_15___S({
                [G]: z,
                func: _ => {
                    const t = _[Q][K][T];
                    this.Exodus_20_15___B = t;
                }
            }), this.Exodus_20_15___B = this.Exodus_20_15___B;
        }
        _EVENT_DISCLAIMER_() {
            if (!v("nodisclaimer")) {
                const _ = o.body.appendChild(A("dialog"));
                _.setHTMLUnsafe('\n          <style>dialog{background:beige;font:21px arial}dialog::backdrop{background:rgba(0, 0, 0, 0.4)}</style>\n          <form method="dialog"><h3>Disclaimer</h3><p>Code, Story and Translations done by AI</p><p>Built with 100% Native JavaScript Web Components</p><button type="submit">Close</button></form>'), 
                _.showModal(), this.onclick = () => _.close(), _.onclick = t => {
                    t.target === _ && _.close();
                };
            }
        }
        Exodus_20_15___AR(_ = undefined) {
            this.titles.disabled = !this.titles.disabled;
        }
        domtree(_ = this.shadowRoot.querySelector("h2")) {
            o.addEventListener("component-tree", (_ => {
                let e = [ ..._.composedPath() ].reverse();
                e = e.slice(e.indexOf(o.body) + 1, 1 / 0);
                let s = 0;
                x("simplified DOM tree"), e.forEach((_ => {
                    t.log(" ".repeat(s), _), s++;
                }));
            }), !0), _?.dispatchEvent(new s("component-tree", {
                bubbles: !0,
                composed: !0
            }));
        }
    }), e.define(a_.Exodus_20_15___AA.name, class extends r_ {
        [X]() {
            const _ = m(a_.Exodus_20_15___AL.name, "", "exportparts='language-select'");
            this.innerHTML = `<h1><img width="32px" src="./favicon/icon.svg"> Civil<span>ai</span>zation ${_}</h1>`;
        }
    }), e.define(a_.Exodus_20_15___AL.name, class extends r_ {
        [X]() {
            u((() => {
                import("https://language-select.github.io/select-button.min.js").then((() => {
                    this.log(0, "<language-select> imported and defined");
                }));
            }), 1), this.attachShadow({
                mode: "open"
            }).append(y(i_ + "{float:right;font-size:80%}" + i_ + ":hover{color:steelblue}" + i_ + "::part(svg){min-width:1em}"), A(i_, {
                attrs: {
                    part: i_,
                    selected: this.Exodus_20_15___m,
                    languages: this.Exodus_20_15___y?.Exodus_20_15___q
                }
            })), this.Exodus_20_15___c({
                scope: o,
                type: "language-select",
                func: _ => this.Exodus_20_15___m = _.detail.iso
            });
        }
    }), e.whenDefined(a_.Exodus_20_15___AE.name).then((() => {
        e.define(a_.Exodus_20_15___AJ.name, class extends((_ => class extends r_ {})(E(a_.Exodus_20_15___AE.name))){
            get Exodus_20_15___y() {
                let _ = this.Exodus_20_15___e(a_.AREA51.name);
                if (_) return _;
                if (_ = o.querySelector(a_.AREA51.name), _) return _;
                throw new Error("No book-reader found");
            }
            connectedCallback() {
                let _ = A(a_.Exodus_20_15___AE.name), t = this[R] || this.getAttribute(R) || this.getAttribute("is");
                t == B && (t = O), _.setAttribute("is", t), this.attachShadow({
                    mode: a_.Exodus_20_15___AJ.shadowRoot
                }).append(y(n_("Exodus_20_15___AJ")), _), this[X] && this[X](), this[__] && this[__]();
            }
        }), e.define(a_.Exodus_20_15___AK.name, class extends r_ {
            [X]() {
                this.Exodus_20_15___y.Exodus_20_15___q.map((_ => {
                    this.append(this.Exodus_20_15___n(a_.Exodus_20_15___AN, {
                        title: _,
                        [R]: _
                    }));
                }));
            }
        }), e.define(a_.Exodus_20_15___AM.name, class extends(E(a_.Exodus_20_15___AJ.name)){
            [X]() {
                this.onclick = () => {
                    this.Exodus_20_15___m = this[R];
                };
            }
        }), e.define(a_.Exodus_20_15___AN.name, class extends(E(a_.Exodus_20_15___AJ.name)){
            [X](_ = this.Exodus_20_15___g, e = this[R]) {
                this.setAttribute("lang", this[R] = e), this.setAttribute("nr", this[T] = _), this.onclick = s => {
                    if (this.style.opacity = .3, r.href.includes("github")) Z("Live translation with OPENAI API disabled", -1); else {
                        const s = async (_, e) => {
                            Z(`Translating chapter ${_}-${e.toUpperCase()}`);
                            let s = setInterval((() => Z("Waiting for OPENAI...", -1)), 6e3), o = this.Exodus_20_15___p({
                                [G]: "translation",
                                nr: _,
                                lang: e
                            }) + "&book=" + this.Exodus_20_15___z;
                            t.warn("API call", o);
                            let i = await this.Exodus_20_15___o({
                                src: o
                            });
                            t.warn({
                                response: i
                            });
                            try {
                                i = JSON.parse(i);
                            } catch (_) {
                                t.error("Failed to parse translation JSON:", {
                                    error: _,
                                    response: i
                                });
                            }
                            clearInterval(s), Z(`Translated ${e.toUpperCase()}-${i.translation.length} chars written to server`, -1);
                        };
                        e == O ? d.keys(this.Exodus_20_15___E).filter((_ => _ != B)).forEach((t => s(_, t))) : s(_, e), 
                        this.remove();
                    }
                };
            }
            [__]() {
                const _ = (this[R], this[T], !1);
                this.classList.toggle(Y, _);
            }
        });
    })), e.define(a_.Exodus_20_15___AH.name, class extends r_ {
        Exodus_20_15___G({idx: _, ...t}) {
            return this.log(2, `create book chapter ${_} in ${a_.Exodus_20_15___AH.name}`), 
            this.Exodus_20_15___n(a_.Exodus_20_15___AI, {
                [b]: {
                    [f]: !0,
                    [a_.Exodus_20_15___AH.name]: this
                },
                Exodus_20_15___M: () => this.Exodus_20_15___m,
                Exodus_20_15___N: () => this.getAttribute(T),
                [T]: ++_,
                ...t
            });
        }
        Exodus_20_15___J() {
            this.Exodus_20_15___w.forEach(((_, t) => {
                this.log(1, "reindex", t + 1, _, _[b]), _.setAttribute(T, t + 1);
            }));
        }
        Exodus_20_15___H({idx: _}) {
            this.log(2, "Exodus_20_15___H", _);
        }
        Exodus_20_15___I({idx: _}) {
            let t = this.Exodus_20_15___w, e = t.length;
            _ > e && (_ = e);
            let s = t[_ - 1];
            s ? s.remove() : g("No chapter to delete", _), this.Exodus_20_15___J();
        }
        [X]() {
            const t = this.Exodus_20_15___y.Exodus_20_15___O;
            let e;
            t ? (this.log(0, `Reading all ${t} Chapters(async)`), e = _.from({
                length: t
            }, ((_, t) => this.Exodus_20_15___G({
                idx: t
            })))) : (g("No chapterCount"), e = [ A("p", {
                style: {
                    color: "red"
                },
                innerHTML: `No ${this.Exodus_20_15___z || "[bookname]"} chapters read from:<b>${this.Exodus_20_15___ysrc}</b>`
            }) ]), this.append(...e);
            let s, o = 0;
            const i = () => {
                o = this.scrollTop;
                for (const _ of this.Exodus_20_15___w) {
                    const t = _.getBoundingClientRect(), e = 600;
                    if (t.top <= e && t.bottom >= e - 300) {
                        this.Exodus_20_15___R(F, {
                            [U]: _.querySelector(a_.Exodus_20_15___AB.name).querySelector("p")
                        });
                        break;
                    }
                }
            };
            this.Exodus_20_15___c({
                scope: this,
                type: "scroll",
                func: () => {
                    var _;
                    _ = i, clearTimeout(s), s = u(_, 200);
                }
            });
        }
    }), e.define(a_.Exodus_20_15___AI.name, class extends r_ {
        set Exodus_20_15___T(_) {
            this.Exodus_20_15___L.innerHTML = "", this.Exodus_20_15___L.append(this.Exodus_20_15___n(a_.Exodus_20_15___AB, {
                innerHTML: _
            }));
        }
        get Exodus_20_15___TMarkdown() {
            let _ = "##" + this.querySelector(P).innerText + "\n";
            return _ += this.Exodus_20_15___L.innerHTML, l.clipboard.writeText(_).then((() => Z("Chapter text copied to clipboard"))).catch((_ => t.error("Failed to copy text:", _))), 
            _;
        }
        [__]() {
            this.loadChapterImages(), this.Exodus_20_15___S({
                scope: o,
                [G]: j,
                func: _ => {
                    this[b][f] = !0, this.Exodus_20_15___y.classList.add("fade-out"), this.Exodus_20_15___U(), 
                    this.loadChapterImages();
                }
            }), this.Exodus_20_15___S({
                scope: o,
                [G]: "chapter-update",
                func: _ => {
                    this.Exodus_20_15___AQ({
                        chapterContent: _.detail.chaptertext,
                        firstupdate: !1
                    });
                }
            });
        }
        async [X]() {
            this.Exodus_20_15___is ? this.Exodus_20_15___U() : g(`No < ${a_.Exodus_20_15___AH.name}> found`, this);
        }
        async Exodus_20_15___U() {
            const _ = this[T];
            t.assert(this.Exodus_20_15___m && _, "%c No .lang and .nr parameters ", p, this.parentNode.nodeName, this), 
            this.setAttribute(R, this.Exodus_20_15___m), this.setAttribute(T, _);
            let e = await this.Exodus_20_15___o({
                [R]: this.Exodus_20_15___m,
                [T]: _
            });
            if ("404" == e) {
                let t = `Chapter ${_} Markdown File Not found`;
                Z(t), e = m(P, `Chapter ${_}`) + m("p", t);
            }
            this.Exodus_20_15___AQ({
                chapterContent: e,
                firstupdate: !0
            });
        }
        Exodus_20_15___AQ({chapterContent: _, firstupdate: t = !1}) {
            this.innerHTML = "", this.append(this.Exodus_20_15___L = A(a_.Exodus_20_15___AB.name, {
                innerHTML: _
            })), t && (this.Exodus_20_15___AO(), this.Exodus_20_15___R(q, {
                [K]: this
            }));
        }
        Exodus_20_15___AO() {
            let _ = this.Exodus_20_15___w, e = _.indexOf(this);
            t.assert(e >= 0, "Chapter not found in allChapters"), _[e][b][f] = !1;
            const s = _.filter((_ => _[b][f]));
            s.length ? this.log(2, `${s.length} Chapters still loading`) : u((() => {
                Z("Book loaded. Chapter:" + this.Exodus_20_15___B), this.Exodus_20_15___l(this.Exodus_20_15___B), 
                this.Exodus_20_15___R(J), this.Exodus_20_15___R(D), this.Exodus_20_15___R("_EVENT_DISCLAIMER_"), 
                this.log(0, `All ${_.length} chapters loaded`, "Event:", D);
            }), 1);
        }
        loadChapterImages() {
            1 == this[T] && u((() => {
                let _ = this.querySelector(a_.Exodus_20_15___AB.name);
                this.log(0, "%c loadChapter hook ", "background:green;color:white", "for more interactive educational content"), 
                _ ? _.insertAdjacentHTML("afterbegin", '<div style="width:100%;b1ackground:lightgrey"><img width="500px" src="./book/civilaization/chapter_imgs/chapter-1.webp" alt="Chapter 1 Image"></div>') : t.error("No chapter-paragraphs found in chapter", this[T]);
            }), 500);
        }
    }), e.define(a_.Exodus_20_15___AG.name, class extends r_ {
        [__]() {
            const {nr: _, lang: t} = this.Exodus_20_15___i;
            this.append(d_({
                is: "github",
                onclick: e => {
                    let s = `https://github.com/${L}/${L}.github.io/blob/main/book/${L}` + this.Exodus_20_15___F(t, _);
                    window.open(s, "_blank");
                }
            }));
        }
    }), e.define(a_.Exodus_20_15___AB.name, class extends r_ {
        [__]() {
            this[T] = this.Exodus_20_15___g, this.innerHTML = [ [ /#{3}\s?([^\n]+)/g, "<h3>$1</h3>" ], [ /#{2}\s?([^\n]+)/g, "<h2>$1</h2>" ], [ /#{1}\s?([^\n]+)/g, "<h1>$1</h1>" ], [ /\*\*\s?([^\n]+)\*\*/g, "<b>$1</b>" ], [ /_([^_`]+)_/g, "<i>$1</i>" ], [ /([^\n]+\n?)/g, "<p>$1</p>" ], [ /([^\n]+)(\*)([^\n]+)/g, "<ul><li>$3</li></ul>" ], [ /!\[([^\]]+)\]\(([^)]+)\s"([^")]+)"\)/g, '<img src="$2" alt="$1" title="$3">' ], [ /\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>' ] ].reduce(((_, [t, e]) => _.replace(t, e)), this.innerHTML), 
            this.querySelectorAll("p:empty").forEach((_ => _.remove())), [ ...this.querySelectorAll("p") ].map(((_, t) => (_.id = `p-${this[T]}-${++t}`, 
            _)));
            let _ = this.querySelector(P);
            if (_) {
                let [t = "namlegne", e = `Undefined Title (Missing Markdown / :in ${P})`] = _.textContent.split(":");
                _.remove(), this.before(this.Exodus_20_15___n(a_.Exodus_20_15___AC, {
                    append: [ A("span", {
                        part: s_,
                        innerHTML: t
                    }), A(P, {
                        part: o_,
                        innerHTML: e
                    }) ]
                }), this.Exodus_20_15___n(a_.Exodus_20_15___AD, {
                    append: [ A(a_.Exodus_20_15___AG.name), A(a_.Exodus_20_15___AK.name) ]
                }));
            } else this.log(0, `%c No ${P} Markdown ## found in chapter ${this[R]}`, "background:orange", this[T] || "No this.nr");
        }
    }), e.define(a_.Exodus_20_15___Z.name, class extends r_ {
        [__]() {
            this[M];
            const _ = this[T];
            this.set(_), this.classList.add(V), this.onclick = () => {
                this.log(1, `%c onclick Goto chapter ${this.nr} `, "background:lightblue"), this.Exodus_20_15___l(this.nr);
            };
        }
        get nr() {
            return ~~this.getAttribute(T);
        }
        set nr(_) {
            this.setAttribute(T, this.innerHTML = this.style.order = _);
        }
        set(_) {
            this.setAttribute(T, this.innerHTML = this.style.order = _);
        }
    }), e.define(a_.Exodus_20_15___Y.name, class extends r_ {
        Exodus_20_15___c_reindex() {
            this.Exodus_20_15___S({
                [G]: J,
                func: () => {
                    let _ = this.Exodus_20_15___K;
                    this.log(0, `Re-index ${_.length} chapterNumbers`), _.forEach(((_, t) => {
                        _.set(t + 1);
                    }));
                }
            });
        }
        [__]() {
            this.Exodus_20_15___c_add_chapter(), this.Exodus_20_15___c_paragraphAtTop(), this.Exodus_20_15___c_reindex();
        }
        get Exodus_20_15___K() {
            return this.querySelectorAll(a_.Exodus_20_15___Z.name);
        }
        Exodus_20_15___c_paragraphAtTop() {
            this.Exodus_20_15___S({
                [G]: F,
                func: _ => {
                    let {[K]: e, [U]: s} = _[Q];
                    s && (e = s.closest(a_.Exodus_20_15___AI.name)), t.assert(e, "%c No chapter in Event detail ", p, _.detail);
                    let o = this.Exodus_20_15___K, i = this.Exodus_20_15___B, a = e[T], n = W;
                    o[i - 1].classList.remove(n), o[a - 1].classList.add(n), this.Exodus_20_15___R(z, {
                        [K]: e
                    });
                }
            });
        }
        Exodus_20_15___c_add_chapter() {
            this.Exodus_20_15___S({
                [G]: q,
                func: _ => {
                    const {[K]: t} = _[Q];
                    t.number || this.append(t.number = this.Exodus_20_15___n(a_.Exodus_20_15___Z, {
                        [M]: t,
                        [T]: t[T]
                    }));
                }
            });
        }
    });
    const d_ = _ => A(a_.Exodus_20_15___AF.name, _);
    e.define(a_.Exodus_20_15___AF.name, class extends a {
        connectedCallback(_ = this.is || this.getAttribute("is")) {
            this.innerHTML = {
                github: '<svg width="30px" viewBox="0 0 96 96"><path d="m49.3 0c-27 0-49 22-49 49 0 22 14 40 33 47 2 0 3-1 3-2 0-1 0-5 0-9-14 3-16-6-16-6-2-6-5-7-5-7-4-3 0-3 0-3 5 0 8 5 8 5 4 7 11 5 14 4 0-3 2-5 3-7-11-1-22-5-22-24 0-5 2-10 5-13 0-1-2-6 0-13 0 0 4-1 13 5a47 47 0 0112-2c4 0 8 1 12 2 9-6 13-5 13-5 3 7 1 12 0 13 3 3 5 8 5 13 0 19-11 23-22 24 2 2 3 4 3 9 0 7 0 12 0 14 0 1 1 3 3 2 19-7 33-25 33-47 3-27-19-49-46-49z"/></svg>'
            }[_], this.setAttribute("part", "icon_" + _);
        }
    });
})();